// exportFunctions.js
import Papa from "papaparse";
import { saveAs } from "file-saver";
import jsPDF from "jspdf";
import "jspdf-autotable";
import MainLogo from "../../images/MainLogo.png";

export const exportToCSV = (
  headers,
  rows,
  filename = "report.csv",
  user = "Unknown",
  title = "Report"
) => {
  const timestamp = new Date().toLocaleString();

  const data = [
    ["TicketEase"],
    [title],
    [],
    headers,
    ...rows,
    [],
    [`Exported By: ${user}`],
    [`Timestamp: ${timestamp}`],
    [],
    ["Generated by TicketEase"],
  ];

  const csv = Papa.unparse(data);
  const blob = new Blob(["\uFEFF" + csv], { type: "text/csv;charset=utf-8;" });
  if (!filename.endsWith(".csv")) filename += ".csv";
  saveAs(blob, filename);
};

export const exportToPDF = (
  headers,
  rows,
  title = "Report",
  filename = "report.pdf",
  user = "Unknown"
) => {
  const timestamp = new Date().toLocaleString();
  const doc = new jsPDF("landscape");
  const pageWidth = doc.internal.pageSize.getWidth();

  const logoWidth = 40;
  const logoHeight = 40;
  const logoX = (pageWidth - logoWidth) / 2;
  doc.addImage(MainLogo, "PNG", logoX, 10, logoWidth, logoHeight);

  doc.setFontSize(16);
  doc.text(title, pageWidth / 2, 60, { align: "center" });

  doc.autoTable({
    head: [headers],
    body: rows,
    startY: 70,
    theme: "grid",
    headStyles: { fillColor: [54, 76, 110], textColor: [255, 255, 255] },
    bodyStyles: { fontSize: 10 },
    didDrawPage: (data) => {
      const pageHeight = doc.internal.pageSize.getHeight();

      doc.setFontSize(10);
      doc.text(`Exported By: ${user}`, pageWidth - 20, pageHeight - 20, {
        align: "right",
      });
      doc.text(`Timestamp: ${timestamp}`, pageWidth - 20, pageHeight - 14, {
        align: "right",
      });

      doc.text("Generated by TicketEase", pageWidth / 2, pageHeight - 8, {
        align: "center",
      });
    },
  });

  if (!filename.endsWith(".pdf")) filename += ".pdf";
  doc.save(filename);
};
